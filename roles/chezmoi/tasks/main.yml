---
# File: roles/chezmoi/tasks/main.yml

- name: Add GitHub to known_hosts (to avoid host key verification failure)
  command: ssh-keyscan github.com >> ~/.ssh/known_hosts
  args:
    creates: ~/.ssh/known_hosts  # Only run if known_hosts doesn't exist yet

- name: Ensure chezmoi is installed
  community.general.homebrew:
    name: chezmoi
    state: present

- name: Initialize chezmoi with dotfiles repo (non-interactive, trusts host key now)
  command: chezmoi init {{ chezmoi_repo }}
  environment:
    # Extra safety: disable strict host key checking just for this command
    GIT_SSH_COMMAND: "ssh -o StrictHostKeyChecking=no"

- name: Apply chezmoi changes
  command: chezmoi apply

- name: Create symlink for .zshenv
  file:
    src: ~/.config/zsh/.zshenv
    dest: ~/.zshenv
    state: link
    force: yes

- name: Open Ghostty app
  command: open -a Ghostty